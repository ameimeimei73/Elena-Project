<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 90%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
      <form method="get">
      <b>Enter start point or click on map:</b>
      <input id="pac-input" name="pac-input" class="controls" type="text" placeholder="Search Box">
      <br>
      <b>Enter end point or click on map:</b>
      <input id="pac-output" name="pac-output" class="controls" type="text" placeholder="Search Box">
      <br>
      <!-- slider -->

      <div id="slidecontainer">
        <b>Maximum percent of shortest path to travel:</b>
    <b>100%</b>
        <input type="range" id="slider" min="100" max="200" value="150">
    <b>200%</b>
      </div>

      <!-- toggleswitch -->

      <label for="flip-1">Elevation:</label>
      <select name="flip-1" id="flip-1" data-role="slider">
          <option value="max">Maximum</option>
          <option value="min">Minimum</option>
      </select> 
      <br>
      <button id="submit" type="button">Submit</button>
    </form>


    <div id="map"></div>
    <script>
      var map;
      function initMap() {
        
        var directionsService = new google.maps.DirectionsService();
        var directionsRenderer = new google.maps.DirectionsRenderer();

        var bounds = new google.maps.LatLngBounds();
        var directionsDisplay = new google.maps.DirectionsRenderer;
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 42.387473, lng: -72.529923},
          zoom: 15
        });
        directionsRenderer.setMap(map);
        $(document).ready(function(){
        $("#submit").click(function(){
            var source =  $("#pac-input").val(); 
            var dest =  $("#pac-output").val();
            var thres =  $("#slider").val();
            var opt =  $("#flip-1").val();
            var data = {"source": source,'dest':dest,'opt':opt,'thres':thres};  
            $.get(

                '{% url 'index' %}',  
                data,  
                function(ret){ 
                  //get our algo' results
                  calculateAndDisplayRoute(directionsService, directionsRenderer,ret);
                })
              })
          });



        var input = document.getElementById('pac-input');
  
        var autocomplete = new google.maps.places.Autocomplete(input);

        map.addListener('bounds_changed', function() {
          autocomplete.setBounds(map.getBounds());
        });

        var markers1 = [];
        autocomplete.addListener('place_changed', function() {
            var place = autocomplete.getPlace();
            markers1.forEach(function(marker) {
              marker.setMap(null);
            });
            markers1 = [];
            markers1.push(new google.maps.Marker({
              map: map,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
            map.fitBounds(bounds);
        });
        var input2 = document.getElementById('pac-output');
        
        var autocomplete2 = new google.maps.places.Autocomplete(input2);
        map.addListener('bounds_changed', function() {
          autocomplete2.setBounds(map.getBounds());
        });
        var markers2 = [];
        autocomplete2.addListener('place_changed', function() {
            var place = autocomplete2.getPlace();
            markers2.forEach(function(marker) {
              marker.setMap(null);
            });
            markers2 = [];
            markers2.push(new google.maps.Marker({
              map: map,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
            map.fitBounds(bounds);
        });
    }
    //show route, not finish
    function calculateAndDisplayRoute(directionsService, directionsRenderer,data) {
        directionsService.route(
            {
              origin: new google.maps.LatLng(data['source'][0], data['source'][1]),
              destination: new google.maps.LatLng(data['dest'][0], data['dest'][1]),
               travelMode: 'WALKING'
            },
            function(response, status) {
              if (status === 'OK') {
                directionsRenderer.setDirections(response);
              } else {
                window.alert('Directions request failed due to ' + status);
              }
            });
        
      }

    </script>



    <script src="https://maps.googleapis.com/maps/api/js?key=yourkey=places&callback=initMap&language=en"
    async defer></script>
  </body>
</html>



